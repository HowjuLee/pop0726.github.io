<html><!-- #BeginTemplate "/Templates/r.dwt" -->
<head>
<!-- #BeginEditable "doctitle" --> 
<title>Untitled Document</title>
<!-- #EndEditable -->
<meta http-equiv="Content-Type" content="text/html; charset="utf-8"">
<link rel="stylesheet" href="../../../css/text.css" type="text/css"><STYLE TYPE="text/css">
<!--
BODY {background-image:  url(../../../img/text/bg.jpg);
background-position: bottom;
background-repeat: no-repeat;
background-attachment: fixed;
}
-->
</STYLE>
</head>

<body bgcolor="#FFFFFF" text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" background="../../../img/text/bg.jpg" > 

<table width="100%" border="0" cellspacing="0" cellpadding="0" class="pt9-black">
  <tr> 
    <td width="10">&nbsp;</td>
    <td>&nbsp;</td>
    <td width="10">&nbsp;</td>
  </tr>
  <tr>
    <td width="10">&nbsp;</td>
    <td> <!-- #BeginEditable "1" --> 　<span class="biaoti_1">2. 执行事务管理语句</span>　<br>
      　　Connection对象可以控制执行数据库事务，通过BeginTrans使数据源初始化事务，而通过CommitTrans和RollbackTrans提交或撤消事务。程序清单6.5说明开始事务和提交事务或撤消事务的过程。<br>
      　(5) 程序清单6.6 控制事务的执行。<br>
      　　<font color="#5a5aad">'---创建Connection对象</font><br>
      　　　Set objConn = Server.CreateObject( &quot;ADODB.Connection &quot; )<br>
      　　<font color="#5a5aad">'---通过存储在Application中连接字符串打开连接</font><br>
      　　　ObjConn.Open Application(&quot;ConnString&quot;)<br>
      　　<font color="#5a5aad">'---开始一个事务管理</font><br>
      　　　ObjConn.BeginTrans<br>
      　　<font color="#5a5aad">'--- 根据商务管理操纵数据库数据.</font><br>
      　　　ObjConn.Execute &quot;UPDATE titles SET price = price * 1.1&quot;<br>
      　　　ObjConn.Execute &quot;UPDATE roysched SET royalty = royalty * 1.2&quot;<br>
      　　<font color="#5a5aad">'---根据商务规则和对数据库操纵的情况决定事务是提交还是取消<br>
      　　'---通过变量booDoIt，决定是提交还是撤消事务</font><br>
      　　　If booDoIt then<br>
      　　　ObjConn.CommitTrans <br>
      　　　Else<br>
      　　　ObjConn.RollbackTrans<br>
      　　　End If<br>
      　　<font color="#5a5aad">程序清单6.6打开一个事务并进行了更新操作，然后根据业务规则设定变量booDoIt ，这个变量用于决定是提交还是撤消事务。<br>
      　　注意记住千万不可在中途关闭Connection对象。还有，事务中应避免刷新使用Connection对象的Recordset。这些动作会造成不同的但难以处理的错误。</font><br>
      <!-- #EndEditable --></td>
    <td width="10">&nbsp;</td>
  </tr>
</table>
</body>
<!-- #EndTemplate --></html>
